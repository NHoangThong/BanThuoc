CREATE DATABASE QLNHATHUOCTAY
USE QLNHATHUOCTAY


CREATE TABLE THUOC
(
	MATHUOC CHAR(10) NOT NULL PRIMARY KEY,
	MALOTHUOC CHAR(10),
	MALOAITHUOC CHAR(11),
	TENTHUOC NVARCHAR(50) NOT NULL,
	DANGTHUOC NVARCHAR(50) NOT NULL,
	CONGDUNG NVARCHAR(50) NOT NULL,
	THANHPHAN NVARCHAR(50) NOT NULL,
	SOLUONGTON INT
)

CREATE TABLE LOAITHUOC
(
	MALOAITHUOC CHAR(11) NOT NULL PRIMARY KEY,
	TENLOAITHUOC NVARCHAR(50) NOT NULL
)

CREATE TABLE LOTHUOC
(
	MALOTHUOC CHAR(10) NOT NULL PRIMARY KEY,
	MAHANGSX CHAR(10) NOT NULL,
	NGAYSX DATE NOT NULL,
	HANSUDUNG DATE NOT NULL
)

CREATE TABLE HANGSANXUAT
(
	MAHANGSX CHAR(10) NOT NULL PRIMARY KEY,
	TENHANGSX NVARCHAR(50) NOT NULL,
	QUOCGIA NVARCHAR(50) NOT NULL
)

CREATE TABLE PHIEUNHAP
(
	MAPN CHAR(10) NOT NULL PRIMARY KEY,
	NGAYNHAP DATE NOT NULL,
	MANHACUNGCAP CHAR(12),
	MANV CHAR(10)
)
CREATE TABLE NHACUNGCAP
(
	MANHACUNGCAP CHAR(12) NOT NULL PRIMARY KEY,
	TENNHACUNGCAP NVARCHAR(50) NOT NULL,
	SDT CHAR(11),
	EMAIL NVARCHAR(50),
)
CREATE TABLE NHANVIEN
(
	MANV CHAR(10) NOT NULL PRIMARY KEY,
	TENNV NVARCHAR(50) NOT NULL,
	SDT CHAR(11) NOT NULL,
	CCCD CHAR(12) NOT NULL,
	EMAIL NVARCHAR(50) NOT NULL,
	MATKHAU NVARCHAR(50) NOT NULL,
	VAITRO NVARCHAR(20) NOT NULL
)

CREATE TABLE PHIEUXUAT
(
	MAPX CHAR(10) NOT NULL PRIMARY KEY,
	NGAYXUAT DATE NOT NULL,
	MAKH CHAR(10),
	MANV CHAR(10)
)

CREATE TABLE KHACHHANG
(
	MAKH CHAR(10) NOT NULL PRIMARY KEY,
	TENKHACHHANG NVARCHAR(50) NOT NULL,
	SDT CHAR(11),
	CCCD CHAR(12) NOT NULL
)
CREATE TABLE CHITIETPHIEUNHAP
(
	MAPN CHAR(10),
	MATHUOC CHAR(10),
	SOLUONG INT,
	DONGIA FLOAT,
	PRIMARY KEY(MAPN, MATHUOC)
)

CREATE TABLE CHITIETPHIEUXUAT
(
	MAPX CHAR(10),
	MATHUOC CHAR(10),
	SOLUONG INT,
	DONGIA FLOAT
	PRIMARY KEY(MAPX,MATHUOC)
)

ALTER TABLE THUOC
ADD FOREIGN KEY(MALOTHUOC)  REFERENCES LOTHUOC(MALOTHUOC)

ALTER TABLE THUOC
ADD FOREIGN KEY(MALOAITHUOC)  REFERENCES LOAITHUOC(MALOAITHUOC)

ALTER TABLE LOTHUOC
ADD FOREIGN KEY(MAHANGSX)  REFERENCES HANGSANXUAT(MAHANGSX)

ALTER TABLE PHIEUNHAP
ADD FOREIGN KEY(MANHACUNGCAP) REFERENCES NHACUNGCAP(MANHACUNGCAP)

ALTER TABLE PHIEUNHAP
ADD FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)

ALTER TABLE PHIEUXUAT
ADD FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH)

ALTER TABLE PHIEUXUAT
ADD FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)


ALTER TABLE CHITIETPHIEUNHAP
ADD FOREIGN KEY(MATHUOC) REFERENCES THUOC(MATHUOC) ON DELETE CASCADE

ALTER TABLE CHITIETPHIEUNHAP
ADD FOREIGN KEY(MAPN) REFERENCES PHIEUNHAP(MAPN)

ALTER TABLE CHITIETPHIEUXUAT
ADD FOREIGN KEY(MATHUOC) REFERENCES THUOC(MATHUOC) ON DELETE CASCADE

ALTER TABLE CHITIETPHIEUXUAT
ADD FOREIGN KEY(MAPX) REFERENCES PHIEUXUAT(MAPX)

-- LOAITHUOC
INSERT INTO LOAITHUOC 
VALUES('LOAITHUOC01',N'Loại thuốc 1'),
 ('LOAITHUOC02',N'Loại thuốc 2'),
 ('LOAITHUOC03',N'Loại thuốc 3'),
 ('LOAITHUOC04',N'Loại thuốc 4'),
 ('LOAITHUOC05',N'Loại thuốc 5'),
 ('LOAITHUOC06',N'Loại thuốc 6'),
 ('LOAITHUOC07',N'Loại thuốc 7');

 -- HANGSANXAT
INSERT INTO HANGSANXUAT 
VALUES('HANGSX01' ,N'Công ty TNHH Dược phẩm A' ,N'Việt Nam'),
('HANGSX02' ,N'Công ty TNHH Dược phẩm B' ,N'Mỹ'),
('HANGSX03' ,N'Công ty TNHH Dược phẩm C' ,N'Nhật Bản'),
('HANGSX04' ,N'Công ty TNHH Dược phẩm D' ,N'Đức'),
('HANGSX05' ,N'Công ty TNHH Dược phẩm E' ,N'Pháp'),
('HANGSX06' ,N'Công ty TNHH Dược phẩm F' ,N'Hàn Quốc'),
('HANGSX07' ,N'Công ty TNHH Dược phẩm G' ,N'Trung Quốc');

-- LOTHUOC
INSERT INTO LOTHUOC 
VALUES ('LOTHUOC01','HANGSX01','2023-01-01','2024-01-01'),
 ('LOTHUOC02','HANGSX02','2023-02-01','2024-02-01'),
 ('LOTHUOC03','HANGSX03','2023-03-01','2024-03-01'),
 ('LOTHUOC04','HANGSX04','2023-04-01','2024-04-01'),
 ('LOTHUOC05','HANGSX05','2023-05-01','2024-05-01'),
 ('LOTHUOC06','HANGSX06','2023-06-01','2024-06-01'),
 ('LOTHUOC07','HANGSX07','2023-07-01','2024-07-01');

-- THUOC
INSERT INTO THUOC 
VALUES ('THUOC01', 'LOTHUOC01', 'LOAITHUOC01', N'Thuốc 1', N'Viên nén', N'Giảm đau', 'Paracetamol', 100),
('THUOC02', 'LOTHUOC02', 'LOAITHUOC02', N'Thuốc 2', N'Dạng bột', N'Hạ sốt', 'Aspirin', 200),
('THUOC03', 'LOTHUOC03', 'LOAITHUOC03', N'Thuốc 3', N'Dạng siro', N'Chống vi khuẩn', 'Amoxicillin', 150),
('THUOC04', 'LOTHUOC04', 'LOAITHUOC04', N'Thuốc 4', N'Dạng gel', N'Chữa bỏng nhẹ', 'Silver sulfadiazine', 120),
('THUOC05', 'LOTHUOC05', 'LOAITHUOC05', N'Thuốc 5', N'Dạng kem', N'Chữa viêm da dị ứng', 'Hydrocortisone acetate', 80),
('THUOC06', 'LOTHUOC06', 'LOAITHUOC06', N'Thuốc 6', N'Dạng viên nén bao tan trong ruột',N'Giảm đau nhức mỏi cơ bắp','Ibuprofen ',50),
('THUOC07','LOTHUOC07','LOAITHUOC07',N'Thuốc 7',N'Dạng viên nén',N'Giảm đau nhức mỏi cơ bắp','Ibuprofen ',50);


-- NHACUNGCAP
INSERT INTO NHACUNGCAP 
VALUES ('NHACUNGCAP01', N'Nhà cung cấp 1', '0123456789', 'ncc1@gmail.com'),
 ('NHACUNGCAP02', N'Nhà cung cấp 2', '0123456788', 'ncc2@gmail.com'),
 ('NHACUNGCAP03', N'Nhà cung cấp 3', '0123456787', 'ncc3@gmail.com'),
 ('NHACUNGCAP04', N'Nhà cung cấp 4', '0123456786', 'ncc4@gmail.com'),
 ('NHACUNGCAP05', N'Nhà cung cấp 5', '0123456785', 'ncc5@gmail.com'),
 ('NHACUNGCAP06', N'Nhà cung cấp 6', '0123456784', 'ncc6@gmail.com'),
 ('NHACUNGCAP07', N'Nhà cung cấp 7', '0123456783', 'ncc7@gmail.com');

 -- NHANVIEN
 INSERT INTO NHANVIEN 
VALUES ('NV01', N'Nguyễn Văn A', '0987654321', '123456789001','admin1@gmail.com','1234','admin'),
('NV02', N'Nguyễn Văn B', '0987654322', '123456789002','nhanvien1@gmail.com','456','salesman'),
('NV03', N'Nguyễn Văn C', '0987654323', '123456789003','nhanvien2@gmail.com','456','salesman'),
('NV04', N'Nguyễn Văn D', '0987654324', '123456789004','admin1@gmail.com','1234','admin'),
('NV05', N'Nguyễn Văn E', '0987654325', '123456789005','admin1@gmail.com','1234','admin'),
('NV06', N'Nguyễn Văn F', '0987654326', '123456789006','nhanvien2@gmail.com','456','salesman'),
('NV07', N'Nguyễn Văn G', '0987654327', '123456789007','nhanvien2@gmail.com','456','salesman');




-- PHIEUNHAP
INSERT INTO PHIEUNHAP 
VALUES ('PN01','2023-01-01','NHACUNGCAP01','NV01'),
 ('PN02','2023-02-01','NHACUNGCAP02','NV02'),
 ('PN03','2023-03-01','NHACUNGCAP03','NV03'),
 ('PN04','2023-04-01','NHACUNGCAP04','NV04'),
 ('PN05','2023-05-01','NHACUNGCAP05','NV05'),
 ('PN06','2023-06-01','NHACUNGCAP06','NV06'),
 ('PN07','2023-07-01','NHACUNGCAP07','NV07');

-- KHACHHANG
INSERT INTO KHACHHANG
VALUES('KH01' ,N'Nguyễn Văn A', '0987654321', '123456789101'),
('KH02' ,N'Nguyễn Văn B', '0987654322', '123456789102'),
('KH03' ,N'Nguyễn Văn C', '0987654323', '123456789103'),
('KH04' ,N'Nguyễn Văn D', '0987654324', '123456789104'), 
('KH05' ,N'Nguyễn Văn E', '0987654325', '123456789105'), 
('KH06' ,N'Nguyễn Văn F', '0987654326', '123456789106'), 
('KH07' ,N'Nguyễn Văn G', '0987654327', '123456789107');


-- PHIEUXUAT
INSERT INTO PHIEUXUAT 
VALUES('PX01' ,'2023-08-01' ,'KH01' ,'NV01'),
('PX02' ,'2023-08-02' ,'KH02' ,'NV02'),
('PX03' ,'2023-08-03' ,'KH03' ,'NV03'),
('PX04' ,'2023-08-04' ,'KH04' ,'NV04'),
('PX05' ,'2023-08-05' ,'KH05' ,'NV05'),
('PX06' ,'2023-08-06' ,'KH06' ,'NV06'),
('PX07' ,'2023-08-07' ,'KH07' ,'NV07');



INSERT INTO CHITIETPHIEUNHAP 
VALUES ('PN01','THUOC01',10,10000),
('PN02','THUOC02',20,20000),
('PN03','THUOC03',30,30000), 
('PN04','THUOC04',40,40000), 
('PN05','THUOC05',50,50000), 
('PN06','THUOC06',60,60000),
('PN07','THUOC07',70,70000);

INSERT INTO CHITIETPHIEUXUAT 
VALUES ('PX01','THUOC01',1,10000),
('PX02','THUOC02',2,20000),
('PX03','THUOC03',3,30000), 
('PX04','THUOC04',4,40000), 
('PX05','THUOC05',5,50000), 
('PX06','THUOC06',6,60000), 
('PX07','THUOC07',7,70000);



GO
CREATE PROCEDURE ThongKeThuocBanRa
    @NgayXuat DATE
AS
BEGIN
    SELECT T.MATHUOC, T.TENTHUOC, CTPX.SOLUONG, CTPX.DONGIA, (CTPX.SOLUONG * CTPX.DONGIA) AS THANHTIEN
    FROM THUOC T
         JOIN CHITIETPHIEUXUAT CTPX ON T.MATHUOC = CTPX.MATHUOC
         JOIN PHIEUXUAT PX ON CTPX.MAPX = PX.MAPX
    WHERE PX.NGAYXUAT = @NgayXuat
END

--HoaDon thanh toan
GO
CREATE PROCEDURE HoaDon
    @MAPX CHAR(10)
AS
BEGIN
    SELECT
        P.MAPX,
        P.NGAYXUAT,
        KH.TENKHACHHANG,
        KH.SDT,
        KH.CCCD,
        NV.TENNV,
        CT.MATHUOC,
        T.TENTHUOC,
        CT.SOLUONG,
        CT.DONGIA,
        (CT.SOLUONG * CT.DONGIA) AS THANHTIEN
    FROM
        PHIEUXUAT P
        INNER JOIN KHACHHANG KH ON P.MAKH = KH.MAKH
        INNER JOIN NHANVIEN NV ON P.MANV = NV.MANV
        INNER JOIN CHITIETPHIEUXUAT CT ON P.MAPX = CT.MAPX
        INNER JOIN THUOC T ON CT.MATHUOC = T.MATHUOC
    WHERE
        P.MAPX = @MAPX;
END;

--EXEC HoaDon @MAPX = 'PX09'


SELECT 
	THUOC.MATHUOC,
    THUOC.MALOTHUOC,
    THUOC.MALOAITHUOC,
    THUOC.TENTHUOC,
	LOTHUOC.NGAYSX,
	LOTHUOC.HANSUDUNG,
	HANGSANXUAT.TENHANGSX,
    THUOC.DANGTHUOC,
    THUOC.CONGDUNG,
    THUOC.THANHPHAN,
    THUOC.SOLUONGTON,
    CHITIETPHIEUNHAP.DONGIA
FROM THUOC, CHITIETPHIEUNHAP,LOTHUOC,HANGSANXUAT
WHERE THUOC.MATHUOC= CHITIETPHIEUNHAP.MATHUOC AND THUOC.MALOTHUOC= LOTHUOC.MALOTHUOC AND LOTHUOC.MAHANGSX=HANGSANXUAT.MAHANGSX

SELECT *FROM THUOC
SELECT *FROM [dbo].[CHITIETPHIEUNHAP]
SELECT *FROM [dbo].[PHIEUNHAP]
SELECT *FROM [dbo].[LOTHUOC]


SELECT *FROM [dbo].[CHITIETPHIEUXUAT]
SELECT *FROM[dbo].[PHIEUXUAT]



----
--CREATE TABLE accounts
--(
--	Id CHAR(10) NOT NULL PRIMARY KEY,
--	username CHAR(10),
--	password CHAR(10),
--	status CHAR(10)
--)

--INSERT INTO accounts 
--VALUES ('1','umer123','1234','admin'),
--('2','mun123','159','salesman'),
--('3','asd123','159','salesman')